URL: http://www.isi.edu/in-notes/rfc1144.ps
Refering-URL: http://www.isi.edu/in-notes/
Root-URL: http://www.isi.edu
Title: Network Working Group V. Jacobson Request for Comments: Compressing TCP/IP Headers for Low-Speed Serial Links
Note: This work was supported in part by the U.S. Department of Energy under Contract Number DE-AC03-76SF00098.  
Date: February 1990  
Pubnum: 1144 LBL  Memo  
Abstract: This RFC is a proposed elective protocol for the Internet community and requests discussion and suggestions for improvement. It describes a method for compressing the headers of TCP/IP datagrams to improve performance over low speed serial links. The motivation, implementation and performance of the method are described. C code for a sample implementation is given for reference. Distribution of this memo is unlimited. 
Abstract-found: 1
Intro-found: 1
Reference: [1] <author> Bingham, J. A. C. </author> <title> Theory and Practice of Modem Design. </title> <publisher> John Wiley & Sons, </publisher> <year> 1988. </year>
Reference-contexts: Five byte headers solve problems (1) and (3) directly and, indirectly, problem (2): A packet size of 100-200 bytes will easily amortize the cost of a five byte header and offer a user 95-98% of the line bandwidth for 2 See the excellent discussion of two-wire dialup line capacity in <ref> [1] </ref>, chap. 11.
Reference: [2] <author> Carey, M. B., Chan, H.-T., Descloux, A., Ingle, J. F., and Park, K. I. </author> <title> 1982/83 end office connection study: Analog voice and voiceband data transmission performance characterization of the public switched network. </title> <journal> Bell System Technical Journal 63, </journal> <volume> 9 (Nov. </volume> <year> 1984). </year>
Reference-contexts: Assuming data transfer in only one direction, that wait averages half the MTU or 500 ms for a 1024 byte MTU at 9600 bps. (3) Any communication medium has a maximum signalling rate, the Shannon limit. Based on an AT&T study <ref> [2] </ref>, the Shannon limit for a typical dialup phone line is around 22,000 bps. <p> For example, the TCP checksum will often not detect two single bit errors separated by 16 bits. For a V.32 modem signalling at 2400 baud with 4 bits/baud, any line hit lasting longer than 400s. would corrupt 16 bits. According to <ref> [2] </ref>, residential phone line hits of up to 2ms. are likely. The correct way to deal with this problem is to provide for error detection at the framing level.
Reference: [3] <author> Chiappa, N., </author> <year> 1988. </year> <title> Private communication. </title>
Reference-contexts: If distinct conversations are separated, this is a fairly effective compression scheme (e.g., typically 12-16 byte headers) that doesn't involve the compressor knowing any details of the packet structure. Variations on this theme have been used, successfully, for a number of years (e.g., the Proteon router's serial link protocol <ref> [3] </ref>). Jacobson [Page 6] rfc 1144 Compressing TCP/IP Headers February 1990 saved packet headerssaved packet headers for n connectionsfor n connections . . .. . . . . .. . .
Reference: [4] <author> Clark, D. D. </author> <title> The design philosophy of the DARPA Internet protocols. </title> <booktitle> In Proceedings of SIGCOMM '88 (Stanford, </booktitle> <address> CA, </address> <month> Aug. </month> <year> 1988), </year> <note> ACM. </note>
Reference-contexts: The ends of each simplex link only have to agree on the most recent packet (s) sent on that link. Thus, although any compression scheme involves shared state, this state is spatially and temporally local and adheres to Dave Clark's principle of fate sharing <ref> [4] </ref>: The two ends can only disagree on the state if the link connecting them is inoperable, in which case the disagreement doesn't matter. 5 Note that although the TCP endpoints are A and B, in this example compression/decompression must be done at the gateway serial links, i.e., between C and
Reference: [5] <author> Farber, D. J., Delp, G. S., and Conte, T. M. </author> <title> A Thinwire Protocol for connecting personal computers to the Internet. Arpanet Working Group Requests for Comment, DDN Network Information Center, </title> <booktitle> SRI International, </booktitle> <address> Menlo Park, CA, </address> <month> Sept. </month> <year> 1984. </year> <month> RFC-914. </month>
Reference-contexts: As of this writing there is active work in all these areas. This memo describes a method that has been used to improve TCP/IP performance over low speed (300 to 19,200 bps) serial links. The compression proposed here is similar in spirit to the Thinwire-II protocol described in <ref> [5] </ref>. <p> Since the 9 This is approximately Thinwire-I from <ref> [5] </ref>. A slight modification is to do a "delta encoding" where the sender subtracts the previous packet from the current packet (treating each packet as an array of 16 bit integers), then sends a 20-bit mask indicating the non-zero differences followed by those differences.
Reference: [6] <author> Kent, C. A., and Mogul, J. </author> <title> Fragmentation considered harmful. </title> <booktitle> In Proceedings of SIGCOMM '87 (Aug. 1987), ACM. </booktitle>
Reference-contexts: The first fragment might contain a complete TCP header and, thus, could be compressed. However the check for a complete TCP header adds quite a lot of code and, given the arguments in <ref> [6] </ref>, it seems reasonable to send all IP fragments uncompressed. 17 The ACK test is redundant since a standard conforming implementation must set ACK in all packets except for the initial SYN packet. However, the test costs nothing and avoids turning a bogus packet into a valid one.
Reference: [7] <author> Lempel, A., and Ziv, J. </author> <title> Compression of individual sequences via variable-rate encoding. </title> <journal> IEEE Transactions on Information Theory IT-24, </journal> <month> 5 (June </month> <year> 1978). </year>
Reference-contexts: Jacobson [Page 20] rfc 1144 Compressing TCP/IP Headers February 1990 MTU (bytes) Line efficiency (%) 0 100 200 300 400 500 600 60 80 100 5.3 Interaction with data compression Since the early 1980's, fast, effective, data compression algorithms such as Lempel-Ziv <ref> [7] </ref> and programs that embody them, such as the compress program shipped with Berkeley Unix, have become widely available. When using low speed or long haul lines, it has become common practice to compress data before sending it.
Reference: [8] <author> Nagle, J. </author> <title> Congestion Control in IP/TCP Internetworks. Arpanet Working Group Requests for Comment, DDN Network Information Center, </title> <booktitle> SRI International, </booktitle> <address> Menlo Park, CA, </address> <month> Jan. </month> <year> 1984. </year> <month> RFC-896. </month>
Reference-contexts: Typing bursts or multiple character keystrokes such as cursor keys can exceed this average rate by factors of two to four. However the bandwidth demand stays approximately constant since the TCP Nagle algorithm <ref> [8] </ref> aggregates traffic with a &lt;200ms interarrival time and the improved header-to-data ratio compensates for the increased data. 4 A similar analysis leads to essentially the same header size limit for bulk data transfer ack packets.
Reference: [9] <author> Perkins, D. </author> <title> Point-to-Point Protocol: A proposal for multi-protocol transmission of datagrams over point-to-point links. Arpanet Working Group Requests for Comment, DDN Network Information Center, </title> <booktitle> SRI International, </booktitle> <address> Menlo Park, CA, </address> <month> Nov. </month> <year> 1989. </year> <month> RFC-1134. </month>
Reference-contexts: Any framing that provides the facilities listed in this paragraph should be adequate for the compression protocol. However, the author encourages potential implementors to see <ref> [9] </ref> for a proposed, standard, SLIP framing. <p> After the error, all reconstructed 25 modulo the TCP checksum. 26 While appropriate error detection is link dependent, the CCITT CRC used in <ref> [9] </ref> strikes an excellent balance between ease of computation and robust error detection for a large variety of links, particularly at the relatively small packet sizes needed for good interactive response. Thus, for the sake of interoperability, the framing in [9] should be used unless there is a truly compelling reason <p> error detection is link dependent, the CCITT CRC used in <ref> [9] </ref> strikes an excellent balance between ease of computation and robust error detection for a large variety of links, particularly at the relatively small packet sizes needed for good interactive response. Thus, for the sake of interoperability, the framing in [9] should be used unless there is a truly compelling reason to do otherwise. <p> In these days of 4 Mbit RAM chips, 2KB seems so little memory that the author recommends the following configuration rules: (1) If the framing protocol does not allow negotiation, the compressor and decompressor should provide sixteen slots, zero through fifteen. 31 The PPP protocol in <ref> [9] </ref> allows the end points to negotiate compression so there is no interoperability problem. However, there should still be a provision for the system manager at each end to control whether compression is negotiated on or off.
Reference: [10] <author> Postel, J., Ed. </author> <title> Internet Protocol Specification. </title> <booktitle> SRI International, </booktitle> <address> Menlo Park, CA, </address> <month> Sept. </month> <year> 1981. </year> <month> RFC-791. </month>
Reference-contexts: One can scavenge a few more bytes by noting that any reasonable link-level framing 6 The TCP and IP protocols and protocol headers are described in <ref> [10] </ref> and [11]. 7 The 96-bit tuple hsrc address, dst address, src port, dst porti uniquely identifies a TCP connection.
Reference: [11] <author> Postel, J., Ed. </author> <title> Transmission Control Protocol Specification. </title> <booktitle> SRI International, </booktitle> <address> Menlo Park, CA, </address> <month> Sept. </month> <year> 1981. </year> <month> RFC-793. </month>
Reference-contexts: One can scavenge a few more bytes by noting that any reasonable link-level framing 6 The TCP and IP protocols and protocol headers are described in [10] and <ref> [11] </ref>. 7 The 96-bit tuple hsrc address, dst address, src port, dst porti uniquely identifies a TCP connection. <p> Unfortunately, if URG is clear, the urgent data field must be checked against the previous packet and, if it changes, an uncompressed tcp packet is sent. (`Urgent data' shouldn't change when URG is clear but <ref> [11] </ref> doesn't require this.) * The difference between the current and previous packet's window field is computed and, if non-zero, is encoded and the W bit is set in the change mask. * The difference between ack fields is computed. <p> The receiving TCP thus gets a duplicate packet and must generate an ack for the next expected sequence number <ref> [11, p. 69] </ref>. This ack will be a duplicate of the last ack the receiver generated so the reverse-path compressor will find no ack, seq number, window or urg change.
Reference: [12] <author> Romkey, J. </author> <title> A Nonstandard for Transmission of IP Datagrams Over Serial Lines: </title> <type> Slip. </type> <institution> Arpanet Working Group Requests for Comment, DDN Network Information Center, SRI International, </institution> <address> Menlo Park, CA, </address> <month> June </month> <year> 1988. </year> <month> RFC-1055. </month>
Reference: [13] <author> Salthouse, T. A. </author> <title> The skill of typing. </title> <publisher> Scientific American 250, </publisher> <month> 2 (Feb. </month> <year> 1984), </year> <pages> 128-135. </pages> <note> Jacobson [Page 26] rfc 1144 Compressing TCP/IP Headers February 1990 </note>
Reference-contexts: The 22Kbps Shannon limit is a hard-limit on data rate through a two-wire telephone connection. 3 See <ref> [13] </ref>. Typing bursts or multiple character keystrokes such as cursor keys can exceed this average rate by factors of two to four.
Reference: [14] <author> Saltzer, J. H., Reed, D. P., and Clark, D. D. </author> <title> End-to-end arguments in system design. </title> <journal> ACM Transactions on Computer Systems 2, </journal> <volume> 4 (Nov. </volume> <year> 1984). </year>
Reference-contexts: With a copy of the last packet sent for each connection, the sender can figure out what fields change in the current packet then 8 The IP header checksum is not an end-to-end checksum in the sense of <ref> [14] </ref>: The time-to-live update forces the IP checksum to be recomputed at each hop. The author has had unpleasant personal experience with the consequences of violating the end-to-end argument in [14] and this protocol is careful to pass the end-to-end TCP checksum through unmodified. See sec. 4. <p> change in the current packet then 8 The IP header checksum is not an end-to-end checksum in the sense of <ref> [14] </ref>: The time-to-live update forces the IP checksum to be recomputed at each hop. The author has had unpleasant personal experience with the consequences of violating the end-to-end argument in [14] and this protocol is careful to pass the end-to-end TCP checksum through unmodified. See sec. 4.
Reference: [15] <author> Shneiderman, B. </author> <title> Designing the User Interface. </title> <publisher> Addison-Wesley, </publisher> <year> 1987. </year> <note> Jacobson [Page 27] rfc 1144 Compressing TCP/IP Headers February 1990 </note>
Reference-contexts: I.e., the line efficiency of a protocol is the ratio of the data to header+data in a datagram. If efficient bulk data transfer is the only objective, it is always possible to make the datagram large enough to approach an efficiency of 100%. Human-factors studies <ref> [15] </ref> have found that interactive response is perceived as "bad" when low-level feedback (character echo) takes longer than 100 to 200 ms.
References-found: 15

