URL: http://www.cs.purdue.edu/homes/ayg/publications/ps/nbody_supercomputing94.ps
Refering-URL: http://www.cs.purdue.edu/homes/ayg/publications/work.html
Root-URL: http://www.cs.purdue.edu
Title: Scalable Parallel Formulations of the Barnes-Hut Method for n-Body Simulations  
Author: Ananth Y. Grama, Vipin Kumar, and Ahmed Sameh 
Address: Minneapolis, MN 55455  
Affiliation: Department of Computer Science, University of Minnesota,  
Abstract: In this paper, we present two new parallel formulations of the Barnes-Hut method. These parallel formulations are especially suited for simulations with irregular particle densities. We first present a parallel formulation that uses a static partitioning of the domain and assignment of subdomains to processors. We demonstrate that this scheme delivers acceptable load balance, and coupled with two collective communication operations, it yields good performance. We present a second parallel formulation which combines static decomposition of the domain with an assignment of subdomains to processors based on Mor-ton ordering. This alleviates the load imbalance inherent in the first scheme. The second parallel formulation is inspired by two currently best known parallel algorithms for the Barnes-Hut method. We present an experimental evaluation of these schemes on a 256 processor nCUBE2 parallel computer for an astrophysical simulation. 
Abstract-found: 1
Intro-found: 1
Reference: [1] <author> A. W. Appel. </author> <title> An efficient program for many-body simulation. </title> <journal> SIAM Journal of Computing, </journal> <volume> 6, </volume> <year> 1985. </year>
Reference-contexts: Interactions between boxes and particles are dictated by a multipole acceptance criteria (MAC). Different algorithms use different MAC. Selection of an appropriate MAC is critical to controlling the error in simulation. Methods in this class include those due to Appel <ref> [1, 4] </ref>, Barnes and Hut [2], and Greengard and Rokhlin [8, 6, 7]. The Barnes-Hut method is one of the most popular methods due to its simplicity.
Reference: [2] <author> J. Barnes and P. Hut. </author> <title> A hierarchical o(n log n) force calculation algorithm. </title> <journal> Nature, </journal> <volume> 324, </volume> <year> 1986. </year>
Reference-contexts: Interactions between boxes and particles are dictated by a multipole acceptance criteria (MAC). Different algorithms use different MAC. Selection of an appropriate MAC is critical to controlling the error in simulation. Methods in this class include those due to Appel [1, 4], Barnes and Hut <ref> [2] </ref>, and Greengard and Rokhlin [8, 6, 7]. The Barnes-Hut method is one of the most popular methods due to its simplicity.
Reference: [3] <author> J. A. Board, J. W. Causey, J. F. Leathrum, A. Winde-muth, and K. Schulten. </author> <title> Accelerated molecular dynamics with the fast multipole algorithm. </title> <institution> Chem. Phys. Let., 198:89, </institution> <year> 1992. </year>
Reference-contexts: Parallel formulations of the Barnes-Hut method involve partitioning the domain (or the tree) among various processors with the combined objectives of optimizing communication and balancing load. If particle densities are uniform across the domain, these objectives are easily met <ref> [3, 16, 9, 11, 7] </ref>. For irregular distributions, these objectives are hard to achieve because of the highly unstructured nature of both computation and communication. Singh et al. [12] and Warren and Salmon [15, 14] present schemes for irregular distributions that try to meet these objectives.
Reference: [4] <author> K. Esselink. </author> <title> The order of appel's algorithm. </title> <journal> Information Processing Letters, </journal> <volume> 41 </volume> <pages> 141-147, </pages> <year> 1992. </year>
Reference-contexts: Interactions between boxes and particles are dictated by a multipole acceptance criteria (MAC). Different algorithms use different MAC. Selection of an appropriate MAC is critical to controlling the error in simulation. Methods in this class include those due to Appel <ref> [1, 4] </ref>, Barnes and Hut [2], and Greengard and Rokhlin [8, 6, 7]. The Barnes-Hut method is one of the most popular methods due to its simplicity.
Reference: [5] <author> Ananth Y. Grama, V. Kumar, and A. Sameh. </author> <title> Scalable parallel formulations of the barnes-hut method for n-body simulations. </title> <type> Technical report, </type> <institution> University of Minnesota, Minneapolis, </institution> <note> 55455, 1994. Also available through anon. FTP from ftp.cs.umn.edu:users/kumar/nbody.ps. </note>
Reference-contexts: This formulation also preserves many of the communication characteristics of the simple scheme. This formulation is hereafter referred to as the hybrid scheme. This paper appears in an extended form in <ref> [5] </ref>. 2 Related Research In this section, we overview two existing parallel formulations of the Barnes-Hut method proposed by Singh et al. [12] (referred to as Costzones) and Warren and Salmon [15] (hereafter referred to as WS).
Reference: [6] <author> L. Greengard. </author> <title> The Rapid Evaluation of Potential Fields in Particle Systems. </title> <publisher> ACM Press, </publisher> <year> 1987. </year>
Reference-contexts: Different algorithms use different MAC. Selection of an appropriate MAC is critical to controlling the error in simulation. Methods in this class include those due to Appel [1, 4], Barnes and Hut [2], and Greengard and Rokhlin <ref> [8, 6, 7] </ref>. The Barnes-Hut method is one of the most popular methods due to its simplicity.
Reference: [7] <author> L. Greengard and W. Gropp. </author> <title> A parallel version of the fast multipole method. </title> <booktitle> Parallel Processing for Scientific Computing, </booktitle> <pages> pages 213-222, </pages> <year> 1987. </year>
Reference-contexts: Different algorithms use different MAC. Selection of an appropriate MAC is critical to controlling the error in simulation. Methods in this class include those due to Appel [1, 4], Barnes and Hut [2], and Greengard and Rokhlin <ref> [8, 6, 7] </ref>. The Barnes-Hut method is one of the most popular methods due to its simplicity. <p> Parallel formulations of the Barnes-Hut method involve partitioning the domain (or the tree) among various processors with the combined objectives of optimizing communication and balancing load. If particle densities are uniform across the domain, these objectives are easily met <ref> [3, 16, 9, 11, 7] </ref>. For irregular distributions, these objectives are hard to achieve because of the highly unstructured nature of both computation and communication. Singh et al. [12] and Warren and Salmon [15, 14] present schemes for irregular distributions that try to meet these objectives.
Reference: [8] <author> L. Greengard and V. Rokhlin. </author> <title> A fast algorithm for particle simulations. </title> <journal> J. Comp. Physics, </journal> <volume> 73 </volume> <pages> 325-348, </pages> <year> 1987. </year>
Reference-contexts: Different algorithms use different MAC. Selection of an appropriate MAC is critical to controlling the error in simulation. Methods in this class include those due to Appel [1, 4], Barnes and Hut [2], and Greengard and Rokhlin <ref> [8, 6, 7] </ref>. The Barnes-Hut method is one of the most popular methods due to its simplicity.
Reference: [9] <author> J. F. Leathrum and J. A. </author> <title> Board. Mapping the adaptive fast multipole algorithm into mimd systems. </title> <editor> In P. Mehrotra and J. Saltz, editors, </editor> <title> Unstructured Scientific Computation on Scalable Multiprocessors. </title> <publisher> MIT Press, </publisher> <address> Cambridge, MA, </address> <year> 1992. </year>
Reference-contexts: Parallel formulations of the Barnes-Hut method involve partitioning the domain (or the tree) among various processors with the combined objectives of optimizing communication and balancing load. If particle densities are uniform across the domain, these objectives are easily met <ref> [3, 16, 9, 11, 7] </ref>. For irregular distributions, these objectives are hard to achieve because of the highly unstructured nature of both computation and communication. Singh et al. [12] and Warren and Salmon [15, 14] present schemes for irregular distributions that try to meet these objectives.
Reference: [10] <author> D. M. Nicol and J. H. Saltz. </author> <title> An analysis of scatter decomposition. </title> <journal> IEEE Transactions on Computers, </journal> <volume> 39 </volume> <pages> 1337-1345, </pages> <month> November </month> <year> 1990. </year>
Reference-contexts: A similar mapping that assigns neighboring subdomains to neighboring processors can be devised for a mesh. The partitioning and mapping are illustrated in Figures 2 (a) and (b). We refer to this assignment as modular assignment. This is similar to modular scatter decomposition discussed by Nicol and Saltz <ref> [10] </ref>. The corresponding tree partitioning imposed by this domain decomposition is illustrated in Figure 3. decomposition into r = p log p clusters.
Reference: [11] <author> K. E. Schmidt and M. A. Lee. </author> <title> Implementing the fast multipole method in three dimensions. </title> <journal> J. Stat. Phys., </journal> <volume> 63:1120, </volume> <year> 1991. </year>
Reference-contexts: Parallel formulations of the Barnes-Hut method involve partitioning the domain (or the tree) among various processors with the combined objectives of optimizing communication and balancing load. If particle densities are uniform across the domain, these objectives are easily met <ref> [3, 16, 9, 11, 7] </ref>. For irregular distributions, these objectives are hard to achieve because of the highly unstructured nature of both computation and communication. Singh et al. [12] and Warren and Salmon [15, 14] present schemes for irregular distributions that try to meet these objectives.
Reference: [12] <author> J. Singh, C. Holt, T. Totsuka, A. Gupta, and J. Hen-nessy. </author> <title> Load balancing and data locality in hierarchical n-body methods. </title> <journal> Journal of Parallel and Distributed Computing, </journal> <note> 1994 (to appear). </note>
Reference-contexts: If particle densities are uniform across the domain, these objectives are easily met [3, 16, 9, 11, 7]. For irregular distributions, these objectives are hard to achieve because of the highly unstructured nature of both computation and communication. Singh et al. <ref> [12] </ref> and Warren and Salmon [15, 14] present schemes for irregular distributions that try to meet these objectives. Motivated by these schemes, in this paper, we propose two new parallel formulations. <p> This formulation is hereafter referred to as the hybrid scheme. This paper appears in an extended form in [5]. 2 Related Research In this section, we overview two existing parallel formulations of the Barnes-Hut method proposed by Singh et al. <ref> [12] </ref> (referred to as Costzones) and Warren and Salmon [15] (hereafter referred to as WS). These schemes are currently acknowledged to be the best known parallel formulations of the algorithm for irregular particle distributions. <p> Since the particles assigned to a processor are localized in physical space, different processors are likely to lock different nodes in the tree. Therefore, the locking overhead incurred in this phase is not significant. Singh et al. <ref> [12] </ref> also present an improved tree construction scheme. This scheme requires all processors to construct local trees assuming that they have the entire domain. These local trees are then merged to form a single tree. <p> All-to-all personalized communication At this point, there are two ways of computing the rest of the interactions. The first, and the commonly used approach, is to get data pertaining to the non-local nodes and perform interactions locally <ref> [12, 14, 15] </ref>. This may require a significant amount of communication because it is difficult to estimate which nonlocal nodes a given particle interacts with. We take algorithm. an alternate approach to computing these interactions. <p> The all-to-all personalized communication provides a sender initiated mode of data communication with messages of coarse granularity. Another drawback identified is the fact that in message passing computers, the programmer explicitly needs to eliminate duplicate requests for the same data item <ref> [12] </ref>. This duplication check is implicit in the force-computation phase of our parallel formulations. A particle can interact with a particular cluster only once and so there is no possibility of sending multiple copies of particle data to the same processor. <p> We have discussed the relationship of these schemes with the existing schemes of Singh et al. <ref> [12] </ref> and Warren and Salmon [15]. We have shown the similarity between the Costzones and WS schemes and show how our parallel formulations enhance the performance of these schemes by using sender initiated coarse grain localized communication.
Reference: [13] <author> J. P. Singh, J. L. Hennessy, and A. Gupta. </author> <title> Implications of hierarchical n-body techniques for multi-computer architectures. </title> <type> Technical Report CSL-TR-92-506, </type> <institution> Stanford University, </institution> <year> 1992. </year>
Reference-contexts: Is the latter approach, used in conjunction with a controlled depth k-to-all broadcast capable of yielding improved perfor mance? * One of the primary deterrents to porting n-body codes to message passing computers identified by Singh et al. <ref> [13] </ref> is the fact that receiver initiated data transfer of small messages over long distances is very expensive. <p> The optimal depth is determined by the accuracy of the simulation, the particle distribution and the number of processor. Typically, for a given particle distribution and a given number of processors, the optimal depth of broadcast increases as ff is decreased. Singh et al. <ref> [13] </ref> identify several drawbacks of programming n-body codes on message passing computers. One of the main drawbacks is the the fact that on-demand or receiver initiated data transfer of small data items over large distances is expensive in message passing computers.
Reference: [14] <author> M. Warren and J. Salmon. </author> <title> Astrophysical n-body simulations using hierarchical tree data structures. </title> <booktitle> In Proceedings of Supercomputing Conference, </booktitle> <year> 1992. </year>
Reference-contexts: If particle densities are uniform across the domain, these objectives are easily met [3, 16, 9, 11, 7]. For irregular distributions, these objectives are hard to achieve because of the highly unstructured nature of both computation and communication. Singh et al. [12] and Warren and Salmon <ref> [15, 14] </ref> present schemes for irregular distributions that try to meet these objectives. Motivated by these schemes, in this paper, we propose two new parallel formulations. These formulations are characterized by their simplicity and performance and capture most of the communication in two collective communication operations. <p> All-to-all personalized communication At this point, there are two ways of computing the rest of the interactions. The first, and the commonly used approach, is to get data pertaining to the non-local nodes and perform interactions locally <ref> [12, 14, 15] </ref>. This may require a significant amount of communication because it is difficult to estimate which nonlocal nodes a given particle interacts with. We take algorithm. an alternate approach to computing these interactions.
Reference: [15] <author> M. Warren and J. Salmon. </author> <title> A parallel hashed oct tree n-body algorithm. </title> <booktitle> In Proceedings of Supercomputing Conference, </booktitle> <year> 1993. </year>
Reference-contexts: Furthermore, FMM uses a number of complicated data structures which make it difficult to program. However, FMM has proven error bounds unlike the Barnes-Hut method. Warren and Salmon <ref> [15] </ref> present a variant of the Barnes-Hut method that has a good worst-case error bound. In this paper, we describe parallel formulations of the Barnes-Hut method. <p> If particle densities are uniform across the domain, these objectives are easily met [3, 16, 9, 11, 7]. For irregular distributions, these objectives are hard to achieve because of the highly unstructured nature of both computation and communication. Singh et al. [12] and Warren and Salmon <ref> [15, 14] </ref> present schemes for irregular distributions that try to meet these objectives. Motivated by these schemes, in this paper, we propose two new parallel formulations. These formulations are characterized by their simplicity and performance and capture most of the communication in two collective communication operations. <p> This formulation is hereafter referred to as the hybrid scheme. This paper appears in an extended form in [5]. 2 Related Research In this section, we overview two existing parallel formulations of the Barnes-Hut method proposed by Singh et al. [12] (referred to as Costzones) and Warren and Salmon <ref> [15] </ref> (hereafter referred to as WS). These schemes are currently acknowledged to be the best known parallel formulations of the algorithm for irregular particle distributions. <p> The top level nodes in the tree are repeatedly accessed by all the processors. Once these nodes are fetched into the cache, all subsequent accesses to these nodes are localized. This reduces communication overhead significantly. 2.2 WS parallel formulation This scheme was originally presented by Warren and Salmon <ref> [15] </ref> using Morton ordering, for a message passing computer. <p> All-to-all personalized communication At this point, there are two ways of computing the rest of the interactions. The first, and the commonly used approach, is to get data pertaining to the non-local nodes and perform interactions locally <ref> [12, 14, 15] </ref>. This may require a significant amount of communication because it is difficult to estimate which nonlocal nodes a given particle interacts with. We take algorithm. an alternate approach to computing these interactions. <p> We have discussed the relationship of these schemes with the existing schemes of Singh et al. [12] and Warren and Salmon <ref> [15] </ref>. We have shown the similarity between the Costzones and WS schemes and show how our parallel formulations enhance the performance of these schemes by using sender initiated coarse grain localized communication. We have also analyzed various parameters of our formulations and experimentally demonstrated the performance of these formulations.
Reference: [16] <author> F. Zhao and S. L. Johnsson. </author> <title> The parallel multipole method on the connection machine. </title> <journal> SIAM J. of Sci. Stat. Comp., </journal> <volume> 12 </volume> <pages> 1420-1437, </pages> <year> 1991. </year>
Reference-contexts: Parallel formulations of the Barnes-Hut method involve partitioning the domain (or the tree) among various processors with the combined objectives of optimizing communication and balancing load. If particle densities are uniform across the domain, these objectives are easily met <ref> [3, 16, 9, 11, 7] </ref>. For irregular distributions, these objectives are hard to achieve because of the highly unstructured nature of both computation and communication. Singh et al. [12] and Warren and Salmon [15, 14] present schemes for irregular distributions that try to meet these objectives.
References-found: 16

