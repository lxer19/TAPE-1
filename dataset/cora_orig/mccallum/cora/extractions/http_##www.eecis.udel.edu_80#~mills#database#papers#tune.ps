URL: http://www.eecis.udel.edu:80/~mills/database/papers/tune.ps
Refering-URL: http://www.eecis.udel.edu:80/~mills/papers.htm
Root-URL: http://www.cis.udel.edu
Title: Improved Algorithms for Synchronizing Computer Network Clocks 1,2,3  
Author: David L. Mills 
Keyword: computer network synchronization, clock synchronization, distributed protocol, disciplined oscillator.  
Affiliation: Electrical Engineering Department University of Delaware  
Abstract: The Network Time Protocol (NTP) is widely deployed in the Internet to synchronize computer clocks to each other and to international standards via telephone modem, radio and satellite. The protocols and algorithms have evolved over more than a decade to produce the present NTP Version 3 specification and implementations. Most of the estimated deployment of 100,000 NTP servers and clients enjoy synchronization to within a few tens of milliseconds in the Internet of today. This paper describes specific improvements developed for NTP Version 3 which have resulted in increased accuracy, stability and reliability in both local-area and wide-area networks. These include engineered refinements of several algorithms used to measure time differences between a local clock and a number of peer clocks in the network, as well as to select the best ensemble from among a set of peer clocks and combine their differences to produce a clock accuracy better than any in the ensemble. This paper also describes engineered refinements of the algorithms used to adjust the time and frequency of the local clock, which functions as a disciplined oscillator. The refinements provide automatic adjustment of message-exchange intervals in order to minimize network traffic between clients and busy servers while maintaining the best accuracy. Finally, this paper describes certain enhancements to the Unix operating system software in order to realize submillisecond accuracies with fast workstations and networks.
Abstract-found: 1
Intro-found: 1
Reference: [ALL87] <author> Allan, D.W. </author> <title> Time and frequency (time-domain) estimation and prediction of precision clocks and oscillators. </title> <journal> IEEE Trans. on Ultrasound, Ferroelectrics, and Frequency Control UFFC-34, </journal> <month> 6 (November </month> <year> 1987), </year> <pages> 647-654. </pages> <note> Also in: Sullivan, D.B., </note> <author> D.W. Allan, D.A. Howe and F.L. </author> <title> Walls (Eds.). Characterization of Clocks and Oscillators . NIST Technical Note 1337, </title> <type> U.S. </type> <institution> Department of Commerce, </institution> <year> 1990, </year> <pages> 121-128. </pages>
Reference-contexts: For the best accuracy and reliability, it is necessary to adjust t on a continuous basis as a function of measured stability. The stability of a freerunning frequency source is commonly characterized by a statistic called Allan variance <ref> [ALL87] </ref>, which is defined as follows. Consider a series of time offsets measured between an oscillator and some external standard. Let q ( i ) be the i th measurement and T be the interval between measurements.
Reference: [BIS90] <author> Bishop, M. </author> <title> A security analysis of the NTP protocol. Report to the Privacy and Security Research Group. </title> <institution> Department of Mathematics and Computer Science, Dartmouth College, </institution> <month> June </month> <year> 1990. </year>
Reference-contexts: A subset of the protocol, designated Simple Network Time Protocol (SNTP), is presented in RFC-1361 [MIL92c]. A security analysis of NTP is presented in <ref> [BIS90] </ref>. NTP and its implementations have evolved and proliferated in the Internet over the last decade, with NTP Version 2 adopted as an Internet Standard (Recommended) [MIL89] and its successor NTP Version 3 adopted as a Internet Standard (Draft).
Reference: [DAR81a] <institution> Defense Advanced Research Projects Agency. Internet Protocol. DARPA Network Working Group Report RFC-791, USC Information Sciences Institute, </institution> <month> Sep-tember </month> <year> 1981. </year>
Reference-contexts: NTP and its implementations have evolved and proliferated in the Internet over the last decade, with NTP Version 2 adopted as an Internet Standard (Recommended) [MIL89] and its successor NTP Version 3 adopted as a Internet Standard (Draft). NTP is built on the Internet Protocol (IP) <ref> [DAR81a] </ref> and User Datagram Protocol (UDP) [POS80], which provide a connectionless transport mechanism; however, it is readily adaptable to other protocol suites. The protocol can operate in several scenarios involving unicast and broadcast modes, private workstations, public servers and various subnet configurations.
Reference: [DAR81b] <institution> Defense Advanced Research Projects Agency. Internet Control Message Protocol. DARPA Network Working Group Report RFC-792, USC Information Sciences Institute, </institution> <month> September </month> <year> 1981. </year>
Reference-contexts: Network Time Protocol The Network Time Protocol (NTP) is used by Internet time servers and their clients to synchronize clocks, as well as automatically organize and maintain the time synchronization subnet itself. It is evolved from the Time Protocol [POS83] and the ICMP Timestamp Message <ref> [DAR81b] </ref>, but is specifically designed for high accuracy, stability and reliability, even when used over typical Internet paths involving multiple gateways and unreliable networks. This section contains an overview of the architecture and algorithms used in NTP.
Reference: [DEC89] <institution> Digital Time Service Functional Specification Version T.1.0.5. Digital Equipment Corporation, </institution> <year> 1989. </year> <title> [DEE90]Deering, S.E., and D.R. Cheriton. Multicast routing in datagram internetworks and extended LANs. </title> <journal> ACM Trans. Computing Systems 8, </journal> <month> 2 (May </month> <year> 1990), </year> <pages> 85-100. </pages>
Reference-contexts: Improved algorithms for synchronizing computer network clocks. Proc. ACM SIGCOMM 94 Symposium (London UK, September 1994), 317-327. zation Service (DTSS) <ref> [DEC89] </ref> could be used as well. After a review of terms and notation in Section 2, Section 3 gives an overview of NTP.
Reference: [DES77] <institution> Data Encryption Standard . Federal Information Processing Standards Publication 46. National Bureau of Standards, U.S. Department of Commerce, </institution> <year> 1977. </year>
Reference-contexts: A lightweight association management capability, including dynamic reachability and 2 variable poll-interval mechanisms, is used to manage state information and reduce resource requirements. Optional features include message authentication based on DES <ref> [DES77] </ref> and MD5 [RSA90] algorithms, as well as provisions for remote control and monitoring. In NTP one or more primary servers synchronize directly to external reference sources such as radio clocks. Secondary time servers synchronize to the primary servers and others in the synchronization subnet.
Reference: [LEV89] <author> Levine, J., M. Weiss, D.D. Davis, D.W. Allan, and D.B. Sullivan. </author> <title> The NIST automated computer time service. </title> <institution> J. Research National Institute of Standards and Technology 94, </institution> <month> 5 (September-October </month> <year> 1989), </year> <pages> 311-321. </pages>
Reference-contexts: The synchronization source for each server is shown by dissemination service if stratum 0 or 1 or by another server if higher. GPS, DCF77 and WWV use radio and satellite, ATOM is a national standard clock ensemble and ACTS is the Automated Computer Time Service operated by NIST <ref> [LEV89] </ref>. The offset, delay, dispersion and synchronization distance for each peer are shown in the table, all in milliseconds. The synchronization status is shown by the Code column.
Reference: [LIN80] <author> Lindsay, W.C., and A.V. Kantak. </author> <title> Network synchronization of random signals. </title> <journal> IEEE Trans. Communications COM-28, </journal> <month> 8 (August </month> <year> 1980), </year> <pages> 1260-1266. </pages>
Reference-contexts: 3 3 2 3 (a) (b) Clock Filter Clock Filter Clock Filter Clock Selection: Intersection and Clustering Algorithms Clock Combining Loop Filter NCO Network Phase-Lock Loop q 0 T 2 T 3 A 3 is a symmetric, continuously sampled, time-transfer scheme similar to those used in some digital telephone networks <ref> [LIN80] </ref>. Among its advantages are that errors due to missing or duplicated messages can be avoided. In [MIL92b] an exhaustive analysis is presented of the time and frequency errors that can accrue as the data are processed and refined at various levels in the subnet hierarchy.
Reference: [MAR85] <author> Marzullo, K., and S. Owicki. </author> <title> Maintaining the time in a distributed system. </title> <booktitle> ACM Operating Systems Review 19, </booktitle> <month> 3 (July </month> <year> 1985), </year> <pages> 44-54. </pages>
Reference-contexts: Criteria for evaluation include a suite of sanity checks, consistency checks and the intersection algorithm described in this section. Recall that the true offset q 0 of a correctly operating clock relative to UTC must be contained in the confidence interval (3). Marzullo and Owicki <ref> [MAR85] </ref> devised an algorithm designed to find an appropriate interval containing the correct time given the confidence intervals of m clocks, of which no more than f are considered incorrect.
Reference: [MIL89] <author> Mills, </author> <title> D.L. Network Time Protocol (version 2) - specification and implementation. </title> <institution> DARPA Network Working Group Report RFC-1119, University of Dela-ware, </institution> <month> September </month> <year> 1989. </year>
Reference-contexts: A security analysis of NTP is presented in [BIS90]. NTP and its implementations have evolved and proliferated in the Internet over the last decade, with NTP Version 2 adopted as an Internet Standard (Recommended) <ref> [MIL89] </ref> and its successor NTP Version 3 adopted as a Internet Standard (Draft). NTP is built on the Internet Protocol (IP) [DAR81a] and User Datagram Protocol (UDP) [POS80], which provide a connectionless transport mechanism; however, it is readily adaptable to other protocol suites.
Reference: [MIL90] <author> Mills, </author> <title> D.L. Measured performance of the Network Time Protocol in the Internet system. </title> <journal> ACM Computer Communication Review 20, </journal> <month> 1 (January </month> <year> 1990), </year> <pages> 65-75. </pages>
Reference-contexts: Computer clocks can be synchronized to within a few tens of milliseconds in the global Internet of today <ref> [MIL90] </ref>. However, as computers and networks become faster, there is every expectation that future applications will require accuracies better than a millisecond. <p> Department servers then operate with all three campus servers and each other, which simplifies configuration table management. Department servers offer service to client hosts, either individually or using the NTP broadcast mode. In a previous paper <ref> [MIL90] </ref> the number of NTP-synchronized peers was estimated at 1,000 on the basis of an systematic survey of all known Internet hosts. Today, such a survey would be very difficult and probably be considered rude at best.
Reference: [MIL91] <author> Mills, </author> <title> D.L. Internet time synchronization: the Network Time Protocol. </title> <journal> IEEE Trans. Communications COM-39, </journal> <month> 10 (October </month> <year> 1991), </year> <pages> 1482-1493. </pages> <note> Also in: Yang, </note> <editor> Z., and T.A. Marsland (Eds.). </editor> <title> Global States and Time in Distributed Systems , IEEE Press, </title> <publisher> Los Alamitos, CA, </publisher> <pages> 91-102. </pages>
Reference-contexts: This section contains an overview of the architecture and algorithms used in NTP. A detailed description of the architecture and service model is contained in <ref> [MIL91] </ref>, while the current protocol formal specification, designated NTP Version 3, is defined in RFC-1305 [MIL92a]. A subset of the protocol, designated Simple Network Time Protocol (SNTP), is presented in RFC-1361 [MIL92c]. A security analysis of NTP is presented in [BIS90]. <p> Clock Filter, Combining and Clustering Algo rithms The clock filter, clustering and combining algorithm shown in Figure 2 operate essentially as described previously in <ref> [MIL91] </ref>, however all three have been refined and defined formally in [MIL92a]. In order to understand the other algorithms described in this paper, it will be useful to briefly summarize the operation of these three algorithms. <p> The clock filter algorithm operates on a moving window of samples to produce three statistical estimates: peer delay d ^ , peer offset q ^ and peer dispersion e ^ . A discussion of the design approach, implementation and performance assessment is given in <ref> [MIL91] </ref> and will not be repeated here.
Reference: [MIL92a] <author> Mills, </author> <title> D.L. Network Time Protocol (Version 3) specification, implementation and analysis. </title> <institution> DARPA Network Working Group Report RFC-1305, University of Delaware, </institution> <month> March </month> <year> 1992, </year> <pages> 113 pp. </pages>
Reference-contexts: This section contains an overview of the architecture and algorithms used in NTP. A detailed description of the architecture and service model is contained in [MIL91], while the current protocol formal specification, designated NTP Version 3, is defined in RFC-1305 <ref> [MIL92a] </ref>. A subset of the protocol, designated Simple Network Time Protocol (SNTP), is presented in RFC-1361 [MIL92c]. A security analysis of NTP is presented in [BIS90]. <p> As shown in the figure, the computed delays and offsets for each peer are processed by the clock filter algorithm to reduce incidental jitter. As described in <ref> [MIL92a] </ref>, this algorithm selects from among the last several samples the one with minimum delay and presents the associated offset as the output. <p> The resulting offsets of this subset are first combined on a weighted-average basis using the algorithm described in <ref> [MIL92a] </ref> and then processed by a phase-lock loop (PLL) using the algorithms described in [MIL92b]. In the PLL the combined offset is processed by the loop filter to control the numeric-controlled oscillator (NCO) frequency. The NCO is implemented as an adjustable-rate counter using a combination of hardware and software components. <p> Clock Filter, Combining and Clustering Algo rithms The clock filter, clustering and combining algorithm shown in Figure 2 operate essentially as described previously in [MIL91], however all three have been refined and defined formally in <ref> [MIL92a] </ref>. In order to understand the other algorithms described in this paper, it will be useful to briefly summarize the operation of these three algorithms.
Reference: [MIL92b] <author> Mills, </author> <title> D.L. Modelling and analysis of computer network clocks. </title> <institution> Electrical Engineering Department Report 92-5-2, University of Delaware, </institution> <month> May </month> <year> 1992, </year> <pages> 29 pp. </pages>
Reference-contexts: Besides some new results, it contains some previous work published only in technical reports <ref> [MIL92b] </ref> and [MIL93]. <p> The resulting offsets of this subset are first combined on a weighted-average basis using the algorithm described in [MIL92a] and then processed by a phase-lock loop (PLL) using the algorithms described in <ref> [MIL92b] </ref>. In the PLL the combined offset is processed by the loop filter to control the numeric-controlled oscillator (NCO) frequency. The NCO is implemented as an adjustable-rate counter using a combination of hardware and software components. <p> Among its advantages are that errors due to missing or duplicated messages can be avoided. In <ref> [MIL92b] </ref> an exhaustive analysis is presented of the time and frequency errors that can accrue as the data are processed and refined at various levels in the subnet hierarchy. <p> However, the method of calculating e , as defined in the NTP Version 3 specification, represents a conservative estimate of the errors due to each of the above causes. In <ref> [MIL92b] </ref> it is shown that, given the e calculated as above, l 2 + e represents the maximum error contribution due to all causes. <p> The characteristic behavior of this PLL model, which is determined by the F ( s ) , is studied in many textbooks and summarized in <ref> [MIL92b] </ref>. The Unix 4.3bsd clock model requires a periodic hardware timer interrupt produced by an oscillator in the 100-1000 Hz range. Each interrupt causes an increment tick to be added to the kernel time variable. <p> The NTP local clock uses the Unix clock model as the NCO and implements the transfer function F ( s ) using a set of recurrence equations described below. A capsule overview of the design extracted from <ref> [MIL92b] </ref> may be helpful in understanding how the model operates. In the NTP local clock algorithm, the Unix clock is continuously adjusted in small increments at fixed adjustment intervals s = 1 s. <p> As described in <ref> [MIL92b] </ref>, the NTP daemon simulates the PLL loop filter and NCO using the above recurrence relations. At each adjustment interval, the offset (4) is provided to the kernel using the adjtime () system call.
Reference: [MIL92c] <author> Mills, </author> <title> D.L. Simple Network Time Protocol (SNTP). </title> <institution> DARPA Network Working Group Report RFC-1361, University of Delaware, </institution> <month> August </month> <year> 1992, </year> <pages> 10 pp. </pages> <institution> [MIL93]Mills, D.L. Precision synchronizatin of computer network clocks. Electrical Engineering Department Report 93-11-1, University of Delaware, </institution> <month> November </month> <year> 1993, </year> <pages> 66 pp. </pages>
Reference-contexts: A detailed description of the architecture and service model is contained in [MIL91], while the current protocol formal specification, designated NTP Version 3, is defined in RFC-1305 [MIL92a]. A subset of the protocol, designated Simple Network Time Protocol (SNTP), is presented in RFC-1361 <ref> [MIL92c] </ref>. A security analysis of NTP is presented in [BIS90]. NTP and its implementations have evolved and proliferated in the Internet over the last decade, with NTP Version 2 adopted as an Internet Standard (Recommended) [MIL89] and its successor NTP Version 3 adopted as a Internet Standard (Draft).
Reference: [NIS90] <institution> NIST Time and Frequency Dissemination Services . NBS Special Publication 432 (Revised 1990), National Institute of Science and Technology, U.S. Department of Commerce, </institution> <year> 1990. </year>
Reference-contexts: If the clocks are to agree with Coordinated Universal Time (UTC), a radio clock (usually a special-purpose radio or satellite receiver) must be provided to synchronize one or more of them to UTC as disseminated by various means <ref> [NIS90] </ref>. Computer clocks can be synchronized to within a few tens of milliseconds in the global Internet of today [MIL90]. However, as computers and networks become faster, there is every expectation that future applications will require accuracies better than a millisecond.
Reference: [POS80] <author> Postel, J. </author> <title> User Datagram Protocol. </title> <institution> DARPA Network Working Group Report RFC-768, USC Information Sciences Institute, </institution> <month> August </month> <year> 1980. </year>
Reference-contexts: NTP is built on the Internet Protocol (IP) [DAR81a] and User Datagram Protocol (UDP) <ref> [POS80] </ref>, which provide a connectionless transport mechanism; however, it is readily adaptable to other protocol suites. The protocol can operate in several scenarios involving unicast and broadcast modes, private workstations, public servers and various subnet configurations.
Reference: [POS83] <author> Postel, J. </author> <title> Time protocol. </title> <institution> DARPA Network Working Group Report RFC-868, USC Information Sciences Institute, </institution> <month> May </month> <year> 1983. </year>
Reference-contexts: Network Time Protocol The Network Time Protocol (NTP) is used by Internet time servers and their clients to synchronize clocks, as well as automatically organize and maintain the time synchronization subnet itself. It is evolved from the Time Protocol <ref> [POS83] </ref> and the ICMP Timestamp Message [DAR81b], but is specifically designed for high accuracy, stability and reliability, even when used over typical Internet paths involving multiple gateways and unreliable networks. This section contains an overview of the architecture and algorithms used in NTP.
Reference: [RAM90] <author> Ramanathan, P., K.G. Shin and R.W. Butler. </author> <title> Fault-tolerant clock synchronization in distributed systems. </title> <booktitle> IEEE Computer 23, </booktitle> <month> 10 (October </month> <year> 1990), </year> <pages> 33-42. </pages>
Reference-contexts: In practice each NTP server synchronizes with several other servers in order to survive outages and Byzantine failures using methods similar to those described in [SHI87]. server model, which has much in common with the phase-lock methods summarized in <ref> [RAM90] </ref>. Timestamps exchanged between the server and each of possibly many other subnet peers at intervals ranging from one to 17 minutes are used to determine individual roundtrip delays and clock offsets, as well as provide reliable error bounds.
Reference: [RSA90] <author> MD5 MessageDigest Algorithm, </author> <title> RSA Data Security, </title> <publisher> Inc., </publisher> <year> 1990. </year>
Reference-contexts: A lightweight association management capability, including dynamic reachability and 2 variable poll-interval mechanisms, is used to manage state information and reduce resource requirements. Optional features include message authentication based on DES [DES77] and MD5 <ref> [RSA90] </ref> algorithms, as well as provisions for remote control and monitoring. In NTP one or more primary servers synchronize directly to external reference sources such as radio clocks. Secondary time servers synchronize to the primary servers and others in the synchronization subnet.
Reference: [SHI87] <author> Shin, K.G., and P. Ramanathan. </author> <title> Clock synchronization of a large multiprocessor system in the presence of malicious faults. </title> <journal> IEEE Trans. Computers C-36, </journal> <volume> 1 (Janu-ary 1987), </volume> <pages> 2-12. </pages>
Reference-contexts: In practice each NTP server synchronizes with several other servers in order to survive outages and Byzantine failures using methods similar to those described in <ref> [SHI87] </ref>. server model, which has much in common with the phase-lock methods summarized in [RAM90].
Reference: [VAS88] <author> Vasanthavada, N., </author> <title> and P.N. Marinos. Synchronization of fault-tolerant clocks in the presence of malicious failures. </title> <journal> IEEE Trans. Computers C-37, </journal> <month> 4 (April </month> <year> 1988), </year> <pages> 440-448. </pages>
Reference-contexts: The clock selection algorithm determines from among all peers a suitable subset capable of providing the most accurate and trustworthy time using principles similar to those described in <ref> [VAS88] </ref>. This is done using a cascade of two subalgorithms, one based on interval intersections to cast out faulty peers and the other based on clustering and maximum likelihood principles to improve accuracy.
References-found: 22

