URL: http://www.cs.columbia.edu/~ezk/research/hlfsd/hlfsd.ps
Refering-URL: http://www.cs.columbia.edu/~ezk/research/index.html
Root-URL: http://www.cs.columbia.edu
Title: HLFSD: Delivering Email to Your $HOME  System Management ARTS  
Author: Erez Zadok, Alexander Dupuy, 
Affiliation: Computer Science Department, Columbia University  
Abstract: We consider the problem of enabling users to access their mailbox files from any host on our local network, and not only on one designated "home machine". We require a solution which will not introduce any new single points of failure, force us to modify mail transfer agents and user agents, or require changes to the operating system kernels. In other words, minimize the amount of work needed by system-administrators and users. Our solution is to deliver mail into the users' home directories, which are exported via NFS[20, 25] to all of the machines on our network. We wrote a small user-level NFS server implementing a single symbolic link that references the home directory of a user, either the one who accessed it, or by name, with a fallback reference in case of failures. This enables electronic mail to be delivered directly into the user's home directory, which is already accessible from any machine on the network. Although we have used our server primarily for mail delivery redirection, it can be used to redirect spooled faxes, access to /tmp, etc. 
Abstract-found: 1
Intro-found: 1
Reference: [1] <author> E. Allman. </author> <title> SENDMAIL An Internetwork Mail Router. In UNIX System Manager's Manual. </title> <institution> University of California, Berkeley, </institution> <year> 1986. </year>
Reference-contexts: Instead, the sending side detected that the filesystem was full, and kept the message in the remote (private) spool directory. This is the default behavior sendmail <ref> [1] </ref> provides. Hlfsd does not introduce any new problems; that is, if a filesystem is completely full, whatever behavior your current LDA provides is maintained.
Reference: [2] <author> F. C. Baran. MW: Mail-Watch. </author> <title> An unpublished manual page, Academic Systems Group, </title> <institution> Columbia University Center for Computing Activities, </institution> <year> 1987. </year>
Reference-contexts: Users like to run mail-watchers <ref> [2, 7] </ref> and read their mail often. The stress on the shared infrastructure increases with every user and 3 host added; loads on the mail server would most certainly be high since all mail delivery goes through that one machine. 4 This leads to lower reliability and performance.
Reference: [3] <author> B. Callaghan and T. Lyon. </author> <booktitle> The Automounter. In Proc. 1989 Winter USENIX Conf., </booktitle> <pages> pp. 43-51, </pages> <month> January </month> <year> 1989. </year>
Reference-contexts: But this solution only makes things worse: since users often run mail watchers, and many popular applications such as trn, emacs, csh or ksh check periodically for new mail, the automounted directory would be effectively permanently mounted. If it gets unmounted automatically by the automounter program <ref> [3] </ref>, it is most likely to get mounted shortly afterwards, consuming more I/O resources by the constant cycle of mount and umount calls. * Reliability: the mail-server host and its network connectivity must be very reliable.
Reference: [4] <author> M. N. Condict. </author> <title> Configuring and Building Mach 3.0. </title> <institution> OSF Research Institute, Grenoble, France. </institution> <note> Unpublished notes available via ftp from mach.cs.cmu.edu:doc/notes/kernel build.doc. </note>
Reference-contexts: In that case it will set the attribute cache value to the shortest possible interval, but it may not be sufficient. 12 6 Related Work The idea of dynamic or variable pathname components is not new. HP-UX does this with context-dependent files [8], and Mach with the "@SYS" variables <ref> [4] </ref>. Both of these implementations support replacement of pathname components by kernel variables. Apollo's DOMAIN/OS supported a more sophisticated system where arbitrary user environment variables could be referenced in pathnames [11, 12].
Reference: [5] <author> M. A. Cooper. </author> <title> Overhauling Rdist for the '90s. </title> <booktitle> Large Installation System Administrators Workshop Proceedings, </booktitle> <pages> pp. 1-8, </pages> <publisher> USENIX, </publisher> <address> Long Beach, CA, </address> <month> October 19-June 23, </month> <year> 1992. </year>
Reference-contexts: The most significant work that SAs need to do is identify programs that need to access mailbox files of other users, and "setgid" them to HLFS GID. In our environment we had to do that for comsat, from, finger and a few others. Our environment uses the rdist <ref> [5] </ref> automatic software distribution program, and thus these changes were required only in one place | the top of our rdist tree. 5.3 Problems There are a few problems, some of which cannot be easily resolved: * Some programs need to be setgid to the special HLFS GID group.
Reference: [6] <author> A. J. Findlay. </author> <title> The Home-Directory Mail System. In EUUG News, </title> <month> Autumn </month> <year> 1988. </year>
Reference-contexts: One such example is hdmail <ref> [6] </ref>. However, hdmail still requires modifying all UAs, the MTA's configuration, installing new daemons, and changing login scripts. This makes the system less upgradable or compatible with others, and adds one more complicated system for SAs to deal with.
Reference: [7] <author> J. Fulton. </author> <title> MIT X Consortium. X11R5 Reference Manual Pages, </title> <type> Section 1: </type> <institution> "xbiff(1)", </institution> <year> 1988. </year>
Reference-contexts: Users like to run mail-watchers <ref> [2, 7] </ref> and read their mail often. The stress on the shared infrastructure increases with every user and 3 host added; loads on the mail server would most certainly be high since all mail delivery goes through that one machine. 4 This leads to lower reliability and performance.
Reference: [8] <institution> Hewlett-Packard Company. </institution> <note> HP-UX Release 9.0 Reference Manual, Section 4: "cdf(4)", </note> <month> August </month> <year> 1992. </year>
Reference-contexts: In that case it will set the attribute cache value to the shortest possible interval, but it may not be sufficient. 12 6 Related Work The idea of dynamic or variable pathname components is not new. HP-UX does this with context-dependent files <ref> [8] </ref>, and Mach with the "@SYS" variables [4]. Both of these implementations support replacement of pathname components by kernel variables. Apollo's DOMAIN/OS supported a more sophisticated system where arbitrary user environment variables could be referenced in pathnames [11, 12].
Reference: [9] <author> IBM Corp. </author> <title> AIX Commands Reference, </title> <booktitle> Volume 1, "bellmail(1)", </booktitle> <pages> pp. </pages> <address> 1-84|1-87, </address> <month> December </month> <year> 1989. </year>
Reference-contexts: Furthermore, this will degrade performance, as local processes as well as remote nfsd processes are kept busy. 5 No SA in their right minds would soft-mount read/write partitions | the chances for data loss are too great. 6 AIX 1.2's bellmail for the IBM PS/2s <ref> [9] </ref>, /bin/mail on SunOS for the Sun 386i machines, and zmailer [27]. 4 * /bin/mail: using a different mail delivery agent could be the solution. One such example is hdmail [6]. However, hdmail still requires modifying all UAs, the MTA's configuration, installing new daemons, and changing login scripts.
Reference: [10] <author> B. Kantor and P. Lapsley. </author> <title> Network News Transfer Protocol. </title> <type> RFC 977, </type> <note> February 1986; 27 p. </note>
Reference-contexts: An alternate way to avoid the need for lock files is to deliver mail one message per file using a different system such as with INN [19] and NNTP <ref> [10] </ref>; however, this would require modifications to all UAs and MTAs. 4.7 Source Code Size, Availability, and Portability Hlfsd is less than 2500 lines of C code, including comments and white-spaces. However, it makes use of almost 4000 lines of code from the amd distribution itself. <p> See also Section 2.3 for more details on various ways in which amd cannot help the way hlfsd can. 6.1 Mail-reading Servers The future of mail reading and sending may be similar to that used by the NNTP protocol used for managing NetNews <ref> [10, 19] </ref>. That is, a special-purpose server which provides network connections for reading and writing mail remotely. Several such programs exist, most notably IMAP [16] and POP [17].
Reference: [11] <author> P. J. Leach, P. H. Levine, B. P. Douros, J. A. Hamilton, D.L. Nelson, and B. L. Stumpf. </author> <title> The Architecture of an Integrated Local Network. </title> <journal> In IEEE Journal on Selected Areas in Communications, </journal> <volume> SAC-1(5), </volume> <pages> pp. 842-856, </pages> <month> November </month> <year> 1983. </year>
Reference-contexts: HP-UX does this with context-dependent files [8], and Mach with the "@SYS" variables [4]. Both of these implementations support replacement of pathname components by kernel variables. Apollo's DOMAIN/OS supported a more sophisticated system where arbitrary user environment variables could be referenced in pathnames <ref> [11, 12] </ref>. On the issue of having a user's home files and mailbox file reside in one location, Plan 9's attach operator can be used to unify several file servers into one user name space [14].
Reference: [12] <author> P. H. Levine. </author> <title> The Apollo DOMAIN Distributed File System. </title> <booktitle> In NATO ASI Series: Theory and Practice of Distributed Operating Systems, </booktitle> <editor> Y. Paker, J-P. Banatre, M. </editor> <booktitle> Bozyigit, </booktitle> <pages> pp. 241-260, </pages> <editor> editors, </editor> <publisher> Springer-Verlag, </publisher> <year> 1987. </year>
Reference-contexts: HP-UX does this with context-dependent files [8], and Mach with the "@SYS" variables [4]. Both of these implementations support replacement of pathname components by kernel variables. Apollo's DOMAIN/OS supported a more sophisticated system where arbitrary user environment variables could be referenced in pathnames <ref> [11, 12] </ref>. On the issue of having a user's home files and mailbox file reside in one location, Plan 9's attach operator can be used to unify several file servers into one user name space [14].
Reference: [13] <author> J. S. Pendry and N. Williams. </author> <title> Amd The 4.4 BSD Automounter. </title> <institution> Imperial College of Science Technology and Medicine, </institution> <address> London. </address> <month> March </month> <year> 1991. </year>
Reference-contexts: None of them is robust. They are mostly very specialized, inflexible, and do not extend to the general case. Some of the ideas are plain bad, potentially leading to lost or corrupt mail: * automounters: using an automounter such as amd <ref> [13] </ref> to provide a set of symbolic links from the normal spool directory to user home directories is not sufficient. UAs rename, unlink, and recreate the mailbox as a regular file, therefore it must be a real file, not a symbolic link.
Reference: [14] <author> R. Pike, D. Presotto, K. Thompson, and H. Trickey. </author> <title> Plan 9 from Bell Labs. </title> <booktitle> In Proceedings of the Summer 1990 UKUUG Conf., </booktitle> <address> London, </address> <month> July, </month> <year> 1990, </year> <pages> pp. 1-9. </pages>
Reference-contexts: On the issue of having a user's home files and mailbox file reside in one location, Plan 9's attach operator can be used to unify several file servers into one user name space <ref> [14] </ref>. What is new about our idea is that we do not require any change to any part of the filesystem implementation in the kernel. All that is required are RPC and NFS, making the system much more widely applicable.
Reference: [15] <author> J. B. Postel. </author> <title> Simple Mail Transfer Protocol. </title> <type> RFC 821, </type> <note> August 1982; 68 p. 14 </note>
Reference: [16] <author> J. Rice. </author> <title> Interactive Mail Access Protocol. </title> <type> RFC 1203, </type> <note> February 1991; 49 p. </note>
Reference-contexts: The overall porting work is significant. Other methods that have yet to catch on require the use of a special mail-reading server, such as IMAP <ref> [16] </ref> or POP [17]. The main disadvantage of these systems is that UAs need to be modified to use these services | a long and involved task. That is why they are not popular at this time. See Section 6.1 for more details. <p> That is, a special-purpose server which provides network connections for reading and writing mail remotely. Several such programs exist, most notably IMAP <ref> [16] </ref> and POP [17]. However, use of these servers is limited at this time because most MTAs and UAs have not been converted to use them, or they require special environments (the Andrew Message Delivery System [18] requires AFS).
Reference: [17] <author> M. Rose. </author> <title> Post Office Protocol. </title> <type> RFC 1225, </type> <note> May 1991; 16 p. </note>
Reference-contexts: The overall porting work is significant. Other methods that have yet to catch on require the use of a special mail-reading server, such as IMAP [16] or POP <ref> [17] </ref>. The main disadvantage of these systems is that UAs need to be modified to use these services | a long and involved task. That is why they are not popular at this time. See Section 6.1 for more details. <p> That is, a special-purpose server which provides network connections for reading and writing mail remotely. Several such programs exist, most notably IMAP [16] and POP <ref> [17] </ref>. However, use of these servers is limited at this time because most MTAs and UAs have not been converted to use them, or they require special environments (the Andrew Message Delivery System [18] requires AFS).
Reference: [18] <author> J. Roseneberg, C. F. Everhart, and N. S. Borenstein. </author> <title> An Overview of the Andrew Message System. </title> <booktitle> In Proceedings of the ACM SIGCOMM '87 Workshop, </booktitle> <address> Stowe, Vermont, </address> <month> August 11-13, </month> <year> 1987, </year> <pages> pp. 99-108. </pages>
Reference-contexts: Several such programs exist, most notably IMAP [16] and POP [17]. However, use of these servers is limited at this time because most MTAs and UAs have not been converted to use them, or they require special environments (the Andrew Message Delivery System <ref> [18] </ref> requires AFS). Porting those applications for most popular environments is not going to be an easy task.
Reference: [19] <author> R. Salz. InterNetNews: </author> <title> Usenet transport for Internet sites. </title> <booktitle> In Proc. 1992 Summer USENIX Conf., </booktitle> <pages> pages 93-98, </pages> <month> June </month> <year> 1992. </year>
Reference-contexts: Our method avoids the need to figure out all the different methods used in locking mail files, and usage of temporary files. An alternate way to avoid the need for lock files is to deliver mail one message per file using a different system such as with INN <ref> [19] </ref> and NNTP [10]; however, this would require modifications to all UAs and MTAs. 4.7 Source Code Size, Availability, and Portability Hlfsd is less than 2500 lines of C code, including comments and white-spaces. However, it makes use of almost 4000 lines of code from the amd distribution itself. <p> See also Section 2.3 for more details on various ways in which amd cannot help the way hlfsd can. 6.1 Mail-reading Servers The future of mail reading and sending may be similar to that used by the NNTP protocol used for managing NetNews <ref> [10, 19] </ref>. That is, a special-purpose server which provides network connections for reading and writing mail remotely. Several such programs exist, most notably IMAP [16] and POP [17].
Reference: [20] <author> R. Sandberg et al. </author> <title> Design and Implementation of the Sun Network Filesystem. </title> <booktitle> In Proc. 1985 Summer Usenix Conf., </booktitle> <pages> pages 119-130, </pages> <month> June </month> <year> 1985. </year>
Reference: [21] <author> Sun Microsystems, Inc. </author> <title> SunOS Reference Manual, Volume I, </title> <type> Section 1: </type> <institution> "biff(1)", </institution> <month> September 9, </month> <year> 1987. </year>
Reference-contexts: Ensuring that users cannot access other users' files can easily be achieved by protecting this subdirectory. In order not to change the behavior of programs like comsat <ref> [21, 23] </ref>, from or finger, which are designed to read any user's mail, we implemented a special check for a designated group.
Reference: [22] <author> Sun Microsystems, Inc. </author> <title> SunOS Reference Manual, Volume II, </title> <type> Section 3: </type> <institution> "syslog(3)", </institution> <month> September 9, </month> <year> 1987. </year>
Reference-contexts: Similar to amd, hlfsd can log debugging and various status information to a designated log file or using the syslog <ref> [22] </ref> facility. The SA may choose to watch these log files and facilities and be notified when serious problems occur such as a full filesystem. 4.4 Avoiding Hangs As described in Section 4.2, hlfsd forks a child at any point where we suspect that an operation might hang.
Reference: [23] <author> Sun Microsystems, Inc. </author> <title> SunOS Reference Manual, Volume I, </title> <type> Section 1: </type> <institution> "comsat(8c)", and "in.comsat(8c)", </institution> <month> September 9, </month> <year> 1987. </year>
Reference-contexts: Ensuring that users cannot access other users' files can easily be achieved by protecting this subdirectory. In order not to change the behavior of programs like comsat <ref> [21, 23] </ref>, from or finger, which are designed to read any user's mail, we implemented a special check for a designated group.
Reference: [24] <author> Sun Microsystems, Inc. </author> <title> SunOS Reference Manual, Volume I, </title> <type> Section 1: </type> <institution> "xsend(1)", "xget(1)", and "enroll(1)", </institution> <month> September 9, </month> <year> 1987. </year>
Reference-contexts: Thus every user who uses /var/tmp would actually be using a subdirectory within their own home directory, rather than taking from system-wide 13 resources. * Other types of user-specific files which get spooled to a particular host, such as Secret Mail <ref> [24] </ref> or electronic faxes can also be redirected for spooling into home directories. 8 Acknowledgments Special thanks go to Daniel Duchamp for his invaluable comments on the paper, to James Tanis who wrote the remailing script and provided useful feedback, and to all members of the technical staff who helped in
Reference: [25] <author> Sun Microsystems, Inc. NFS: </author> <title> Network File System Protocol specification. </title> <type> RFC 1094, </type> <address> 1989 March; 27 p. </address>
Reference: [26] <author> L. Wall and R. L. Schwartz. </author> <title> Programming Perl. </title> <publisher> O'Reilly & Associates, Inc., </publisher> <address> Sebastopol, CA (1991). </address>
Reference-contexts: In our environment, with 750 users, that translates to about 37KB | rather insignificant given that workstations these days come installed with at least 16-32MB of RAM. 5.1.1 Remailing Lost Mail The hlfsd distribution contains a perl <ref> [26] </ref> script called lostaltmail. Remailing a single message with a body size of 1KB, takes an average of 1.2 seconds (total time). In our department, resending an average mailbox file takes about 20 seconds.

References-found: 26

