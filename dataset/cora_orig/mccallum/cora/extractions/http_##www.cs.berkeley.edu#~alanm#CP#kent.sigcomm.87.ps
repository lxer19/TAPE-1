URL: http://www.cs.berkeley.edu/~alanm/CP/kent.sigcomm.87.ps
Refering-URL: http://www.cs.berkeley.edu/~alanm/CP/bib.html
Root-URL: 
Title: Fragmentation Considered Harmful  d i g i t a  
Author: Christopher A. Kent Jeffrey C. Mogul l 
Address: 100 Hamilton Avenue Palo Alto, California 94301 USA  
Affiliation: Western Research Laboratory  
Date: December, 1987  
Abstract-found: 0
Intro-found: 1
Reference: [1] <author> Art Berggreen. </author> <title> IP Datagram Sizes. Electronic distribution of the TCP-IP Discussion Group, </title> <publisher> no Message-ID. </publisher> <month> May 22, </month> <year> 1987. </year>
Reference-contexts: The process may have to be repeated if a subsequent link has a slightly smaller MTU. (A variant of this scheme was first proposed by Art Berggreen <ref> [1] </ref>.) This scheme has a serious danger: if the source host does not receive or act upon the warning message, not only will fragmentation continue to occur, but a lot of useless traffic will be created by subsequent warning messages.
Reference: [2] <author> David R. Boggs, John F. Shoch, Edward A. Taft, and Robert M. Metcalfe. Pup: </author> <title> An internetwork architecture. </title> <journal> IEEE Transactions on Communications COM-28(4):612-624, </journal> <month> April, </month> <year> 1980. </year>
Reference-contexts: datagram size; this means that most of the problems associated with inter-network fragmentation would still be present, although to a lesser degree. (Transparent fragmentation was successful in the Pup architecture because almost all non-gateway Pup hosts were attached to networks with MTUs larger than the maximum allowed Pup datagram size <ref> [2] </ref>.) Since transparent fragmentation is invisible except to the gateways involved, it can be used in an IP internet wherever the benefits outweigh the drawbacks; this is specifically allowed by the IP specification [19].
Reference: [3] <author> David R. Cheriton. VMTP: </author> <title> A transport protocol for next generation communication systems. </title> <booktitle> In SIGCOMM '86. ACM SIGCOMM, </booktitle> <month> August, </month> <year> 1986. </year>
Reference-contexts: It would be a poor idea to put the entire fragmentation avoidance mechanism in, say, the TCP layer, because both the mechanism and any additional protocol would have to be duplicated in parallel layers, such as UDP [18], NETBLT [6], and VMTP <ref> [3] </ref>, and because it would be awkward for a TCP-based mechanism to share knowledge with other layers and across connections. This is not to say that layers above IP should be uninvolved in fragmentation avoidance. Architectural layering does not mean that higher layers must be kept ignorant of fragmentation issues.
Reference: [4] <author> J. Noel Chiappa. </author> <title> IP Datagram Sizes. Electronic distribution of the TCP-IP Discussion Group, </title> <address> Message-ID &lt;12304502322.33.JNC@XX.LCS.MIT.EDU&gt;. </address> <month> May 22, </month> <year> 1987. </year>
Reference-contexts: Since route choices may depend on the IP ``Type of Service'' and perhaps the IP ``Security'' option, probes should carry the same Type of Service and Security as the data packets will <ref> [4] </ref>; gateways should observe Type of Service and Security when updating values in probes. 12 FRAGMENTATION CONSIDERED HARMFUL 3.2.2.
Reference: [5] <author> David D. Clark. </author> <title> IP Datagram Reassembly Algorithms. </title> <type> RFC 815, </type> <institution> Network Information Center, SRI International, </institution> <month> July, </month> <year> 1982. </year>
Reference-contexts: The reassembly process consists of matching the protocol and identification fields of incoming fragments with those of fragments already held, and coalescing the data into complete datagrams. Fragments must be discarded if their TTL expires while they are held for reassembly. (For more details of the reassembly algorithm, see <ref> [5] </ref>.) Higher level protocols such as TCP (Transmission Control Protocol) [20] use IP as a basis to implement a reliable connection between two client processes.
Reference: [6] <author> David D. Clark, Mark L. Lambert, and Lixia Zhang. NETBLT: </author> <title> A Bulk Data Transfer Protocol. </title> <type> RFC 998, </type> <institution> Network Information Center, SRI International, </institution> <month> March, </month> <year> 1987. </year>
Reference-contexts: It would be a poor idea to put the entire fragmentation avoidance mechanism in, say, the TCP layer, because both the mechanism and any additional protocol would have to be duplicated in parallel layers, such as UDP [18], NETBLT <ref> [6] </ref>, and VMTP [3], and because it would be awkward for a TCP-based mechanism to share knowledge with other layers and across connections. This is not to say that layers above IP should be uninvolved in fragmentation avoidance.
Reference: [7] <author> Geof Cooper. </author> <title> IP Datagram Sizes. Electronic distribution of the TCP-IP Discussion Group, </title> <address> Message-ID &lt;8705230517.AA01407@apolling.imagen.uucp&gt;. </address> <month> May 23, </month> <year> 1987. </year>
Reference-contexts: The source host, upon receiving this ICMP, should try a smaller datagram size and retransmit any unacknowledged data. (A variant of this scheme was first proposed by Geof Cooper <ref> [7] </ref>.) This method requires no protocol changes, but the drawback is that until the proper MINMTU is discovered, many datagrams will be dropped, and thus it may take a long time to set up a connection.
Reference: [8] <author> F. E. Heart, R. E. Kahn. S. M. Ornstein, W. R. Crowther, and D. C. Walden. </author> <title> The interface message processor for the ARPA computer network. </title> <booktitle> In Proc. AFIPS Spring Joint Computer Conference, </booktitle> <pages> pages 551-567. </pages> <month> May, </month> <year> 1970. </year>
Reference-contexts: For example, the actual IMP-to-IMP messages on the ARPAnet are only 1008 bits long; the 1007-byte MTU of the ARPAnet is an illusion created by transparent fragmentation and reassembly within the IMPs <ref> [8] </ref>. 3.5. Careful use of intentional fragmentation In certain restricted cases, and with a little luck, one can obtain significant performance improvements by sending such large datagrams that they must be fragmented immediately by the source host, before being transmitted on their first hop.
Reference: [9] <author> Van Jacobson. Retransmit Timers: </author> <note> Theory and Practice. In preparation. </note>
Reference-contexts: This approach should therefore be used only when an independent mechanism is used to detect or suppress congestion, such as the use of ICMP source quenches, Nagle's fair-queueing algorithm [17], or statistical properties of the round-trip delays <ref> [9] </ref>. 3.3.3. Proper use of ``Time Exceeded'' ICMP messages The receiving host can tell if it is losing fragments because partial datagrams waiting on its reassembly queue will time out.
Reference: [10] <author> Mike Karels. </author> <title> IP Datagram Sizes. Electronic distribution of the TCP-IP Discussion Group, </title> <address> Message-ID &lt;8705262316.AA08021@okeefe.Berkeley.EDU&gt;. </address> <month> May 26, </month> <year> 1987. </year>
Reference-contexts: Hop Count The total number of links traversed along the route may be of interest, for example, in choosing a value for the ``Time To Live'' field. (Collection of hop counts was proposed by Mike Karels <ref> [10] </ref>.) It is not necessary for every gateway along the path to support probing, providing they all forward the probe. Gaps in the probe information are not fatal; at worst, host behavior is the same as if no probing is done.
Reference: [11] <author> Charles Lynn. </author> <title> TCP maximum segment size determination. Electronic distribution of the TCP-IP Discussion Group, </title> <address> Message-ID &lt;[G.BBN.COM]17-Nov-87 11:38:24.CLYNN&gt;. </address> <month> November 17, </month> <year> 1987. </year>
Reference-contexts: Since the ICMP message carries the IP header of some fragment of the datagram, and since that header includes the fragment length rather than the datagram length, the sending host obtains a lower bound on MINMTU. Charles Lynn has described some elegant modifications to this mechanism <ref> [11] </ref>. First, the receiving host can use the largest fragment of an incompletely received datagram to provide the IP header returned in the ICMP message, thereby making the lower bound on MINMTU as tight as possible.
Reference: [12] <author> Charles Lynn. </author> <title> IP Datagram Sizes. Electronic distribution of the TCP-IP Discussion Group, </title> <address> Message-ID &lt;[G.BBN.COM]22-May-87 20:11:55.CLYNN&gt;. </address> <month> May 22, </month> <year> 1987. </year>
Reference-contexts: Again, some mechanism is needed to limit unheeded warnings, so as to prevent congestion. (A variant of this scheme was first proposed by Charles Lynn <ref> [12] </ref>.) 3.4. Use of Transparent Fragmentation The need for inter-network fragmentation, and consequently its dangers, can be reduced or eliminated by the use of transparent fragmentation (sometimes called intra-network fragmentation).
Reference: [13] <author> M. Kirk McKusick, Mike Karels, and Sam Leffler. </author> <title> Performance Improvements and Functional Enhancements in 4.3BSD. </title> <booktitle> In Proc. Summer USENIX Conference, </booktitle> <pages> pages 519-531. </pages> <month> June, </month> <year> 1985. </year>
Reference-contexts: However, it is quite easy to implement and in general provides good performance. A variant of this scheme, implemented in the TCP layer, has been used for several years at many sites and is now incorporated in 4.3BSD Unix <ref> [13] </ref>. This is the method we recommend in the absence of protocol changes. 3.1.3. Send 576-byte datagrams if the route goes off-net Instead of checking whether a destination is behind a gateway, the IP layer can examine the destination's network number to decide if it is local or non-local.
Reference: [14] <author> Dave Mills. </author> <title> IP Datagram Sizes. Electronic distribution of the TCP-IP Discussion Group, </title> <address> Message-ID &lt;8705261315.a029301@Huey.UDEL.EDU&gt;. </address> <month> May 26, </month> <year> 1987. </year>
Reference-contexts: It is not possible to coalesce a complete initial string of fragments and partially acknowledge receipt of the datagram in order to free some of the buffer space. This leads to the behavior shown in figure 2. (Dave Mills first pointed out this behavior in <ref> [14] </ref>.) It is difficult to decide how long to hold on to received fragments. The only firm limit is the TTL field; the reassembly process must discard fragments as their TTLs expire.
Reference: [15] <author> Jeffrey Mogul. </author> <title> Internet Subnets. </title> <type> RFC 917, </type> <institution> Network Information Center, SRI International, </institution> <month> October, </month> <year> 1984. </year>
Reference-contexts: It is not perfect, since 1. It does not avoid fragmentation on every path. 2. It may unnecessarily limit packet size, especially on subnetted collections of high speed LANs that all support large packets. 3. If proxy ARP is used <ref> [15] </ref> then the IP layer may be fooled into believing that a non-local path is local, and thus use large datagrams when they are not necessarily safe. However, it is quite easy to implement and in general provides good performance.
Reference: [16] <author> Jeffrey Mogul and Jon Postel. </author> <title> Internet Standard Subnetting Procedure. </title> <type> RFC 950, </type> <institution> Network Information Center, SRI International, </institution> <month> August, </month> <year> 1985. </year>
Reference-contexts: While it is true that by keeping per-destination-network information one might be able to pool information about several hosts, this is not necessarily safe. Because many networks are subnetted <ref> [16] </ref>, because MTUs may vary among the subnets of a given network, and because one cannot tell whether a remote network is subnetted or not, it is not true that knowing the MINMTU for one host reliably gives you the MINMTU for all other hosts on the same network.
Reference: [17] <author> John B. Nagle. </author> <title> On Packet Switches with Infinite Storage. </title> <journal> IEEE Transactions on Communications COM-35(4):435-438, </journal> <month> April, </month> <year> 1987. </year> <title> 29 FRAGMENTATION CONSIDERED HARMFUL </title>
Reference-contexts: Maximum queue length A high value implies congestion; if measured using the ``fair-queueing'' algorithm <ref> [17] </ref> it indicates to a host whether it is sending too much. Alternatively, a ``congestion encountered'' flag could be set if any gateway along the path is experiencing congestion. <p> This approach should therefore be used only when an independent mechanism is used to detect or suppress congestion, such as the use of ICMP source quenches, Nagle's fair-queueing algorithm <ref> [17] </ref>, or statistical properties of the round-trip delays [9]. 3.3.3. Proper use of ``Time Exceeded'' ICMP messages The receiving host can tell if it is losing fragments because partial datagrams waiting on its reassembly queue will time out.
Reference: [18] <author> Jon Postel. </author> <title> User Datagram Protocol. </title> <type> RFC 768, </type> <institution> Network Information Center, SRI International, </institution> <month> August, </month> <year> 1980. </year>
Reference-contexts: It would be a poor idea to put the entire fragmentation avoidance mechanism in, say, the TCP layer, because both the mechanism and any additional protocol would have to be duplicated in parallel layers, such as UDP <ref> [18] </ref>, NETBLT [6], and VMTP [3], and because it would be awkward for a TCP-based mechanism to share knowledge with other layers and across connections. This is not to say that layers above IP should be uninvolved in fragmentation avoidance.
Reference: [19] <author> Jon Postel. </author> <title> Internet Protocol. </title> <type> RFC 791, </type> <institution> Network Information Center, SRI International, </institution> <month> September, </month> <year> 1981. </year>
Reference-contexts: A good discussion of both methods, in more detail, may be found in Shoch [24]. In this paper, drawing on experience with a large heterogeneous internetwork, we examine fragmentation in the context of the IP protocol <ref> [19] </ref>. <p> IP datagrams are encapsulated in network-specific packets. Gateways may fragment an incoming packet if it will not fit in a single outgoing packet; in this case, each fragment is sent as a separate packet. The IP header contains several fields that are used to manage fragmentation <ref> [19] </ref>: Identification: A 16-bit field assigned by the sender to aid in assembling the fragments of a datagram. The tuple (source, destination, protocol, identification) for a given datagram must be unique over all existing datagrams. <p> Alternatively, one might assume that using a 576-byte limit is small enough to avoid fragmentation in virtually all cases (we hope that in the future, all new IP network links would be capable of handling packets of this size). 576 bytes is set forth in the IP specification <ref> [19] </ref> as the maximum size a host can send without explicit permission from the receiving host, so it is reasonable as an arbitrary value. 10 FRAGMENTATION CONSIDERED HARMFUL 3.1.2. <p> non-gateway Pup hosts were attached to networks with MTUs larger than the maximum allowed Pup datagram size [2].) Since transparent fragmentation is invisible except to the gateways involved, it can be used in an IP internet wherever the benefits outweigh the drawbacks; this is specifically allowed by the IP specification <ref> [19] </ref>. We encourage designers of gateways and networks to consider the use of transparent fragmentation, especially if the natural MTU of the network is unusually small.
Reference: [20] <author> Jon Postel. </author> <title> Transmission Control Protocol. </title> <type> RFC 793, </type> <institution> Network Information Center, SRI International, </institution> <month> September, </month> <year> 1981. </year>
Reference-contexts: Fragments must be discarded if their TTL expires while they are held for reassembly. (For more details of the reassembly algorithm, see [5].) Higher level protocols such as TCP (Transmission Control Protocol) <ref> [20] </ref> use IP as a basis to implement a reliable connection between two client processes. Portions of the data stream known as segments are sent in individual IP datagrams, along with control information used by the cooperating TCP processes to ensure reliable communication.
Reference: [21] <author> Jon Postel. </author> <title> Internet Control Message Protocol. </title> <type> RFC 792, </type> <institution> Network Information Center, SRI International, </institution> <month> September, </month> <year> 1981. </year>
Reference-contexts: If a datagram reaches a gateway that would have to fragment it, the gateway (obeying the ``Don't Fragment'' flag) must drop the datagram and return an ICMP ``Destination Unreachable/Fragmentation Needed and DF Set'' message <ref> [21] </ref>. <p> Internet Probe Message Protocol This section describes the proposed Internet Probe Message Protocol (IPMP). IPMP is modeled after the Internet Control Message Protocol (ICMP) <ref> [21] </ref>; the only purpose in defining it as a separate protocol instead of as a specific ICMP message type is to simplify gateway processing of IP packets. Normally, a gateway need not understand or modify any part save the IP header of a datagram being forwarded.
Reference: [22] <author> Russel Sandberg, David Goldberg, Steve Kleiman, Dan Walsh, and Bob Lyon. </author> <title> Design and Implementation of the Sun Network Filesystem. </title> <booktitle> In Proc. Summer USENIX Conference, </booktitle> <pages> pages 119-130. </pages> <month> June, </month> <year> 1985. </year>
Reference-contexts: This is done in Sun Microsystems' implementation of their NFS protocol <ref> [22] </ref>. Throughput is improved because fewer datagrams are handled in the layers above IP, and because end-to-end acknowledgments are done only in the RPC layer, rather than in the transport layer as well.
Reference: [23] <author> Alan Sheltzer, Robert Hinden, and Mike Brescia. </author> <title> Connecting different types of networks with gateways. </title> <journal> Data Communications :119-126, </journal> <month> August, </month> <year> 1982. </year>
Reference-contexts: In a heterogeneous internet, such as the DARPA IP Internet, these packet-size limits, known as MTUs (for maximum transmission unit) vary widely: from 254 bytes for Packet Radio networks to 2000 bytes for the Wideband Satellite Network <ref> [23] </ref>; since nobody knows exactly what is connected to the Internet, the range in MTUs may be even broader.
Reference: [24] <author> John Shoch. </author> <title> Packet Fragmentation in Inter-Network Protocols. </title> <booktitle> Computer Networks 3(1) </booktitle> <pages> 3-8, </pages> <month> February, </month> <year> 1979. </year>
Reference-contexts: If the fragments are allowed to follow independent routes, and are reassembled only upon reaching their ultimate destination, this is called inter-network fragmentation. A good discussion of both methods, in more detail, may be found in Shoch <ref> [24] </ref>. In this paper, drawing on experience with a large heterogeneous internetwork, we examine fragmentation in the context of the IP protocol [19].

References-found: 24

