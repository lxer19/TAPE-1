URL: http://www.eecis.udel.edu:80/~mills/database/papers/allan.ps
Refering-URL: http://www.eecis.udel.edu:80/~mills/papers.htm
Root-URL: http://www.cis.udel.edu
Title: Adaptive Hybrid Clock Discipline Algorithm for the Network Time Protocol 1,2  
Author: David L. Mills, Member ACM, IEEE 
Keyword: computer network time synchronization, clock discipline algorithm, oscillator error modeling, feedback control loop  
Date: 3  
Abstract: This paper describes the analysis, implementation and performance of a new algorithm engineered to discipline a computer clock to a source of standard time, such as a GPS receiver or another computer synchronized to such a source. The algorithm is intended for the Network Time Protocol (NTP), which is in widespread use to synchronize computer clocks in the global Internet, or with another functionally equivalent protocol such as DTSS or PCS. It controls the computer clock time and frequency using an adaptive-parameter, hybrid phase/frequency-lock feedback loop. Compared with the current NTP Version 3 algorithm, the new algorithm developed for NTP Version 4 provides improved accuracy and reduced network overhead, especially when per-packet or per-call charges are involved. The algorithm has been implemented in a special purpose NTP simulator, which also includes the entire suite of NTP algorithms. The performance has been verified using this simulator and both synthetic data and real data from Inter net time servers in Europe, Asia and the Americas.
Abstract-found: 1
Intro-found: 1
Reference: <institution> References 3-5 are available from Internet archives in PostScript format. Contact the author for location and availability. </institution>
Reference: 1. <author> Allan, D.W. </author> <title> Time and frequency (time-domain) estimation and prediction of precision clocks and oscillators. </title> <journal> IEEE Trans. on Ultrasound, Ferro electrics, and Frequency Control UFFC-34, </journal> <month> 6 (November </month> <year> 1987), </year> <pages> 647-654. </pages> <note> Also in: Sullivan, D.B., </note> <author> D.W. Allan, D.A. Howe and F.L. </author> <title> Walls (Eds.). Characterization of Clocks and Oscillators . NIST Technical Note 1337, </title> <type> U.S. </type> <institution> Department of Commerce, </institution> <year> 1990, </year> <pages> 121-128. </pages>
Reference-contexts: Since the clock oscillator is not temperature stabilized, its frequency may vary over a few PPM in the normal course of the day. The traditional characterization of oscillator stability is a plot of Allan variance <ref> [1] </ref>, which is defined using a series of time differences measured between a computer clock and some external standard. Let x k surement and t be the interval between measurements. Define the fractional frequency , k &gt; 0, (7) which is a dimensionless quantity.
Reference: 2. <author> Levine, J. </author> <title> An algorithm to synchronize the time of a computer to universal time. </title> <journal> IEEE Trans. </journal> <note> Net working 3, </note> <month> 1 (February </month> <year> 1995), </year> <pages> 42-50. </pages>
Reference-contexts: few seconds to well over a day, depending on accuracy requirements and acceptable network overhead. 2.1 Time and Frequency Discipline In the new design, the loop filter of Figure 2 is implemented using two subalgorithms, one based on a conventional PLL and the other on a FLL design suggested in <ref> [2] </ref>. Both predict a time correction x as a function of V . The PLL predicts a frequency adjustment y PLL integral of V s t , while the FLL predicts an adjustment y as an exponential average of . <p> Assuming the frequency noise is fixed by oscillator type, it would seem that a simple measurement of phase noise would suffice to determine the Allan intercept and optimum point to switch between FLL and PLL modes. As in <ref> [2] </ref>, the phase noise could be measured for each Internet server prior to regular operation and the optimum point determined. However, as confirmed by experiment, this is not practical in the current Internet. congested during working hours in Europe and the U.S.
Reference: 3. <author> Mills, D.L., A. Thyagarajan and B.C. Huffman. </author> <title> Internet timekeeping around the globe. Proc. Precision Time and Time Interval (PTTI) Applications and Planning Meeting (Long Beach CA, Decem ber 1997). </title>
Reference-contexts: There are no explicit means to control crystal ambient temperature, power level, voltage regulation or mechanical stability. For instance, in a survey of about 20,000 Internet hosts synchronized by NTP, the median frequency error was 78 PPM <ref> [3] </ref>, with some hosts showing errors over 500 PPM. Since the clock oscillator is not temperature stabilized, its frequency may vary over a few PPM in the normal course of the day.
Reference: 4. <author> Mills, </author> <title> D.L. Improved algorithms for synchroniz ing computer network clocks. </title> <journal> IEEE/ACM Trans. Networks (June 1995), </journal> <pages> 245-254. </pages>
Reference-contexts: Using available technology with existing workstations and Internet paths, it has been demonstrated that computers can be reliably synchronized to better than a millisecond in LANs and better than a few tens of milliseconds in most places in the global Internet <ref> [4] </ref>. This technology includes the Network Time Protocol (NTP), now used in an estimated total of over 100,000 servers and clients in the global Internet. Over 230 public primary servers are available in this network, each connected to a external source, such as a GPS receiver or ACTS telephone modem. <p> The algorithm has been implemented both in the NTP software itself and, for the highest accuracy, in the operating system kernel. The current NTP Version 3 discipline, together with improvements already implemented and described in <ref> [4] </ref>, represent the departure point for this paper. The new algorithm is intended for NTP Version 4, which is in 1. <p> While not in itself the subject of this paper, a brief overview of the NTP design will be helpful in understanding the algorithms involved. A comprehensive description of the NTP architecture, protocol and algorithms is in <ref> [4] </ref> and citations found there. The global NTP time synchronization subnet is a hierarchical tree of time servers, and clients organized in much the same way as digital telephone synchronization networks. The primary servers at the root of the tree are synchronized to national standards by radio or telephone modem. <p> The characteristic behavior of this model, which is determined by F ( t ) and the various gain factors, is studied in many textbooks and summarized in <ref> [4] </ref>. Clock Filter Predictor Clock Adjust VFO Phase Detector NTP V s r q - c y Loop Filter 3 The original NTP Version 3 discipline, which is based on a conventional PLL, has been improved to include a FLL capability. <p> This is necessary to avoid step changes in time, as well as to implement the lag network required for a stable PLL. In PLL mode, y is a time integral over all past values of V , so From <ref> [4] </ref>, this results in a transfer function , (3) where is the loop gain and is the corner frequency. From elementary theory, this is the transfer function of a linear, time-invariant, PLL which can drive both time and frequency errors to zero. <p> As determined by past experience and experiment <ref> [4] </ref>, the various data grooming algorithms work well to sift good data from bad, especially under conditions of light to moderate network and server loads. However, under conditions of extreme network or server congestion, operating system latencies, and oscillator wander, any discipline may perform poorly and even become unstable. <p> Conclusions The results demonstrated in this paper show a substantial improvement in the performance of the NTP Version 4 discipline over both the original NTP Version 3 algorithm and the improved algorithm described in <ref> [4] </ref>. In addition, the new algorithm automatically selects the optimum combination of FLL and PLL data over a wide range of network jitter and oscillator wander while in regular operation and not requiring initial calibration.
Reference: 5. <author> Mills, </author> <title> D.L. Clock discipline algorithms for the Network Time Protocol Version 4. </title> <institution> Electrical Engineering Department Report 97-3-3, Univer sity of Delaware, </institution> <month> March </month> <year> 1997, </year> <pages> 35 pp. </pages>
Reference-contexts: The x and y are then used by the clock adjust process to control the VFO frequency and close the feedback loop shown in Figure 1. An overview will suffice to describe how the correction and prediction algorithms work. The details, which are given in <ref> [5] </ref>, are beyond the scope of this paper. At each update, a phase correction (1) is initialized, then exponentially amortized in V c clock adjust process at rate 1/ T c , where T c is the loop time constant. <p> In cases of moderate to severe network jitter and with multiple sources, this sometimes causes frequent clockhopping which in turn degrades accuracy. A key statistic in controlling t is the system dispersion, which is a determined from the RMS errors measured by the grooming algorithms <ref> [5] </ref>. If is greater then the system dispersion by an experimentally determined constant factor, the oscillator frequency is deviating too fast for the discipline to follow. In this case, t is reduced in stages to the minimum.
Reference: 6. <author> Stein, </author> <title> S.R. Frequency and time - their measure ment and characterization (Chapter 12). In: E.A. </title> <editor> Gerber and A. Ballato (Eds.). </editor> <title> Precision Frequency Control, Vol. </title> <publisher> 2 , Academic Press, </publisher> <address> New York 1985, </address> <pages> 191-232, 399-416. </pages> <note> Also in: Sullivan, D.B., </note> <author> D.W. Allan, D.A. Howe and F.L. </author> <title> Walls (Eds.). Characterization of Clocks and Oscillators . National Institute of Standards and Technology Technical Note 1337, </title> <type> U.S. </type> <institution> Government Printing Office (January, </institution> <year> 1990), </year> <month> TN61-TN119. </month>
Reference-contexts: The shape of each curve depends on the phase and frequency variations specific to the particular clock oscillator and network path involved. The phase variations, which are dominated by white phase noise, produce straight lines with slope -1 on the plots <ref> [6] </ref>. The frequency variations, which are dominated by random-walk frequency noise, produce straight lines with slope +0.5 on the plots. The intersection of these two lines, called here the Allan intercept , characterizes each particular clock oscillator and network path.
References-found: 7

